<!DOCTYPE html>
<html>
<head>
    <title>Grafik Total Qty per Nama per Bulan</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h2>Grafik Total Qty Berdasarkan Nama per Bulan 2024</h2>

<canvas id="grafikBar" width="400" height="200"></canvas>

<script>
    fetch("data.csv")
        .then(response => response.text())
        .then(csv => {
            const rows = csv.trim().split("\n").slice(1);

            const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

            // Struktur: { NAMA: { Jan:0, Feb:0, ... } }
            let dataMap = {};

            rows.forEach(row => {
                if (row.trim() === "") return;

                const cols = row.split(";");  
                const tanggal = cols[1];
                const nama = cols[3];
                const qty = parseInt(cols[4]);

                if (isNaN(qty)) return;

                // Ambil bulan dari tanggal
                const bulanIndex = new Date(tanggal).getMonth(); // 0â€“11
                const bulan = monthNames[bulanIndex];

                if (!dataMap[nama]) {
                    dataMap[nama] = {};
                    monthNames.forEach(m => dataMap[nama][m] = 0);
                }

                dataMap[nama][bulan] += qty;
            });

            // Siapkan dataset untuk chart
            const datasets = Object.keys(dataMap).map(nama => {
                return {
                    label: nama,
                    data: monthNames.map(m => dataMap[nama][m]),
                    borderWidth: 1,
                    backgroundColor: `hsl(${Math.random()*360},70%,55%)`
                };
            });

            const ctx = document.getElementById("grafikBar").getContext("2d");

            new Chart(ctx, {
                type: "bar",
                data: {
                    labels: monthNames,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        });
</script>

</body>
</html>
