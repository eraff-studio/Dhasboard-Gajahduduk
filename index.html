<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CSV Chart Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
</head>
<body style="font-family: Arial; padding: 20px;">
  <h2>Grafik dari CSV (GitHub Pages)</h2><canvas id="myChart" width="600" height="350"></canvas>

  <script>
    // ==========================
    // 1. Fungsi Fetch CSV dari GitHub
    // ==========================
    fetch('data.csv')
      .then(response => {
        if (!response.ok) throw new Error('CSV tidak ditemukan atau salah lokasi');
        return response.text();
      })
      .then(csvText => parseCSV(csvText))
      .catch(err => {
        document.body.innerHTML += `<p style='color:red'>Error: ${err.message}</p>`;
      });

    // ==========================
    // 2. Parsing CSV
    // ==========================
    function parseCSV(text) {
      const rows = text.trim().split(/
?
/).map(r => r.split(';'));

      const headers = rows[0];
      const dataRows = rows.slice(1);

      // Buat array kosong untuk tiap kolom
      const columns = {};
      headers.forEach((h, i) => {
        columns[h] = dataRows.map(r => {
          const val = r[i].trim();
          return val === '' ? null : isNaN(val) ? val : Number(val);
        });
      });

      renderChart(headers, columns, dataRows.length);
    }

    // ==========================
    // 3. Render ChartJS
    // ==========================
    function renderChart(headers, columns, length) {
      const labels = Array.from({ length }, (_, i) => `Data-${i + 1}`);
      const randomColor = () => `hsl(${Math.random() * 360}, 70%, 50%)`;

      const datasets = headers.map(h => ({
        label: h,
        data: columns[h],
        borderColor: randomColor(),
        backgroundColor: randomColor(),
        fill: false,
        tension: 0.2
      }));

      new Chart(document.getElementById('myChart'), {
        type: 'line',
        data: { labels, datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: { y: { beginAtZero: true } }
        }
      });
    }
  </script></body>
</html>
